<app-header title="Clerk Dashboard"></app-header>

<main class="page">
  <section class="card section-card">
    <h3>Cash Operations</h3>

    <div class="operation-grid">
      <form [formGroup]="depositForm" class="operation-box" (ngSubmit)="deposit()">
        <h4>Deposit</h4>
        <input formControlName="accountNumber" placeholder="Account Number" />
        <input type="number" formControlName="amount" placeholder="Amount" />
        <button class="btn btn-primary" [disabled]="depositForm.invalid">Deposit</button>
      </form>

      <form [formGroup]="withdrawForm" class="operation-box" (ngSubmit)="withdraw()">
        <h4>Withdraw</h4>
        <input formControlName="accountNumber" placeholder="Account Number" />
        <input type="number" formControlName="amount" placeholder="Amount" />
        <button class="btn btn-secondary" [disabled]="withdrawForm.invalid">Withdraw</button>
      </form>
    </div>
  </section>

  <section class="card section-card">
    <h3>Account Lookup</h3>
    <form [formGroup]="accountLookupForm" (ngSubmit)="lookupAccount()" class="grid-3">
      <input formControlName="accountNumber" placeholder="Account Number" />
      <span></span>
      <button class="btn btn-secondary" [disabled]="accountLookupForm.invalid">Load Account</button>
    </form>

    <table *ngIf="selectedAccount">
      <tr><th>Account Number</th><th>Name</th><th>Balance</th></tr>
      <tr>
        <td>{{ selectedAccount.accountNumber }}</td>
        <td>{{ selectedAccount.name }}</td>
        <td>{{ selectedAccount.balance | currency : 'INR' }}</td>
      </tr>
    </table>
  </section>

  <section class="card section-card">
    <h3>Transaction Lookup</h3>
    <form [formGroup]="transactionLookupForm" (ngSubmit)="lookupTransactionById()" class="grid-3">
      <input formControlName="transactionId" placeholder="Transaction ID" />
      <span></span>
      <button class="btn btn-secondary" [disabled]="transactionLookupForm.invalid">Load Transaction</button>
    </form>

    <table *ngIf="selectedTransaction">
      <tr><th>ID</th><th>Account</th><th>Type</th><th>Amount</th><th>Status</th><th>Performed By</th><th>Approved By</th><th>Date</th></tr>
      <tr>
        <td>{{ selectedTransaction.transactionId }}</td>
        <td>{{ selectedTransaction.accountNumber }}</td>
        <td>{{ selectedTransaction.transactionType }}</td>
        <td>{{ selectedTransaction.amount | currency : 'INR' }}</td>
        <td>{{ selectedTransaction.status }}</td>
        <td>{{ selectedTransaction.performedBy }}</td>
        <td>{{ selectedTransaction.approvedBy || '-' }}</td>
        <td>{{ selectedTransaction.createdAt | date : 'medium' }}</td>
      </tr>
    </table>
  </section>

  <section class="card section-card">
    <h3>Transaction History (Read-only)</h3>
    <form [formGroup]="historyForm" (ngSubmit)="loadHistory()" class="grid-3">
      <input formControlName="accountNumber" placeholder="Account Number" />
      <span></span>
      <button class="btn btn-secondary" [disabled]="historyForm.invalid">Load History</button>
    </form>

    <table>
      <tr><th>ID</th><th>Account</th><th>Type</th><th>Amount</th><th>Status</th><th>Performed By</th><th>Approved By</th><th>Date</th></tr>
      <tr *ngFor="let transaction of history">
        <td>{{ transaction.transactionId }}</td>
        <td>{{ transaction.accountNumber }}</td>
        <td>{{ transaction.transactionType }}</td>
        <td>{{ transaction.amount | currency : 'INR' }}</td>
        <td>{{ transaction.status }}</td>
        <td>{{ transaction.performedBy }}</td>
        <td>{{ transaction.approvedBy || '-' }}</td>
        <td>{{ transaction.createdAt | date : 'short' }}</td>
      </tr>
      <tr *ngIf="history.length === 0"><td colspan="8" class="empty">No transactions available for selected account.</td></tr>
    </table>
  </section>

  <section class="card section-card">
    <h3>Accounts (Read-only list)</h3>
    <table>
      <tr><th>No.</th><th>Name</th><th>Balance</th></tr>
      <tr *ngFor="let account of accounts">
        <td>{{ account.accountNumber }}</td>
        <td>{{ account.name }}</td>
        <td>{{ account.balance | currency : 'INR' }}</td>
      </tr>
      <tr *ngIf="accounts.length === 0"><td colspan="3" class="empty">No accounts available.</td></tr>
    </table>
  </section>

  <p class="error" *ngIf="error">{{ error }}</p>
  <p class="success" *ngIf="success">{{ success }}</p>
</main>
