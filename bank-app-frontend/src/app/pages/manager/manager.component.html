<app-header title="Manager Dashboard"></app-header>

<main class="page">
  <p class="loading" *ngIf="loading">Loading dashboard...</p>

  <section class="card">
    <h3>Summary</h3>
    <p>Total Accounts: <strong>{{ accounts.length }}</strong></p>
    <p>Pending Withdrawals: <strong>{{ pendingTransactions.length }}</strong></p>
  </section>

  <section class="card">
    <h3>Create Account</h3>
    <form [formGroup]="accountForm" (ngSubmit)="createAccount()" class="grid-2">
      <input formControlName="name" placeholder="Customer name" />
      <input type="number" formControlName="balance" placeholder="Opening balance" />
      <button class="btn btn-primary" [disabled]="accountForm.invalid">Create</button>
    </form>
  </section>

  <section class="card">
    <h3>Accounts</h3>
    <table>
      <tr><th>No.</th><th>Name</th><th>Balance</th></tr>
      <tr *ngFor="let account of accounts">
        <td>{{ account.accountNumber }}</td>
        <td>{{ account.name }}</td>
        <td>{{ account.balance | currency : 'INR' }}</td>
      </tr>
    </table>
  </section>

  <section class="card">
    <h3>Clerk User Management</h3>
    <form [formGroup]="clerkForm" (ngSubmit)="createClerk()" class="grid-2">
      <input formControlName="username" placeholder="clerk username" />
      <input formControlName="password" type="password" placeholder="minimum 8 characters" />
      <button class="btn btn-secondary" [disabled]="clerkForm.invalid">Create Clerk</button>
    </form>

    <table>
      <tr><th>Username</th><th>Status</th><th>Action</th></tr>
      <tr *ngFor="let clerk of clerks">
        <td>{{ clerk.username }}</td>
        <td>{{ clerk.active ? 'Active' : 'Disabled' }}</td>
        <td>
          <button class="btn" (click)="disableClerk(clerk.username)" [disabled]="!clerk.active">Disable</button>
        </td>
      </tr>
    </table>
  </section>

  <section class="card">
    <h3>Withdrawal Approvals</h3>
    <table>
      <tr><th>ID</th><th>Account</th><th>Amount</th><th>By</th><th>Action</th></tr>
      <tr *ngFor="let transaction of pendingTransactions">
        <td>{{ transaction.transactionId }}</td>
        <td>{{ transaction.accountNumber }}</td>
        <td>{{ transaction.amount | currency : 'INR' }}</td>
        <td>{{ transaction.performedBy }}</td>
        <td>
          <button class="btn btn-primary" (click)="approve(transaction.transactionId)">Approve</button>
          <button class="btn" (click)="reject(transaction.transactionId)">Reject</button>
        </td>
      </tr>
    </table>
  </section>

  <section class="card">
    <h3>Transaction History (Read-only)</h3>
    <form [formGroup]="historyForm" (ngSubmit)="loadHistory()" class="grid-2">
      <input formControlName="accountNumber" placeholder="Enter account number" />
      <button class="btn btn-secondary">View History</button>
    </form>

    <table>
      <tr><th>Txn ID</th><th>Type</th><th>Amount</th><th>Status</th><th>Date</th></tr>
      <tr *ngFor="let transaction of history">
        <td>{{ transaction.transactionId }}</td>
        <td>{{ transaction.transactionType }}</td>
        <td>{{ transaction.amount | currency : 'INR' }}</td>
        <td>{{ transaction.status }}</td>
        <td>{{ transaction.createdAt | date : 'medium' }}</td>
      </tr>
    </table>
  </section>

  <p class="error" *ngIf="error">{{ error }}</p>
  <p class="success" *ngIf="success">{{ success }}</p>
</main>
